name: github-pages-deploy
on: [workflow_dispatch]
# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  Download-Deploy-Latest-Artifact:
    runs-on: ubuntu-latest
    steps:
      - name: Download latest release artifact
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          RESPONSE=$(curl -L \
          -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer $GITHUB_TOKEN " \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/armyaali/portfolio/releases/latest)  
          URL=$(echo $RESPONSE | json_pp | grep "browser_download_url" | grep -oP 'https:\/\/.*(?=")')
          echo $URL
          wget $URL
          mv *.gz gh-pages.gz

      - name: Upload artifact
        uses: actions/upload-artifact@main
        with:
          name: gh-pages.gz
          path: gh-pages.gz
          retention-days: 30

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1
